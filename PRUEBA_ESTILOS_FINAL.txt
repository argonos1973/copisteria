â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  ğŸ”§ SOLUCIÃ“N FINAL - ESTILOS QUE SE PIERDEN AL NAVEGAR
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

PROBLEMA IDENTIFICADO:
====================
El script auto_branding.js estaba al FINAL del <head> en estadisticas.html,
ejecutÃ¡ndose MUY TARDE. Esto causaba que los estilos se aplicaran despuÃ©s
de que otros scripts ya hubieran cargado el DOM.

SOLUCIÃ“N APLICADA:
==================
1. auto_branding.js movido al INICIO del <head> âœ…
2. branding.js versiÃ³n incrementada: v13 â†’ v14 âœ…
3. Listener del iframe corregido âœ…
4. Apache reiniciado âœ…

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  ğŸ“‹ INSTRUCCIONES PARA PROBAR (MODO INCÃ“GNITO)
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

1. CERRAR COMPLETAMENTE EL NAVEGADOR
   - Cerrar TODAS las ventanas
   - Incluyendo las de modo incÃ³gnito

2. ABRIR NUEVO MODO INCÃ“GNITO
   Ctrl + Shift + N (Chrome)
   Ctrl + Shift + P (Firefox)

3. ABRIR DEVTOOLS **ANTES** DE CARGAR LA PÃGINA
   F12 o Ctrl + Shift + I
   â†’ Tab "Console"

4. IR A LA URL
   http://localhost:5001

5. HACER LOGIN
   Usuario: admin
   Password: admin123

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  ğŸ” QUÃ‰ VERIFICAR EN LA CONSOLA
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

AL CARGAR EL LOGIN/DASHBOARD (parent):
======================================
[MENU] MenÃº renderizado correctamente
[MENU] Cargando colores de empresa...
[BRANDING] Cargando colores...
[BRANDING] Color primario (menÃº): #ffffff
[BRANDING] âœ… Estilos aplicados directamente a 1 menÃºs
[BRANDING] âœ“ Iframe encontrado, aplicando estilos dentro...
[BRANDING] âœ“ Listener configurado para detectar navegaciÃ³n

AL CARGAR ESTADISTICAS (iframe):
================================
[AUTO-BRANDING v2.0] ğŸ¨ Iniciando carga de estilos...
[AUTO-BRANDING] URL actual: http://localhost:5001/estadisticas.html
[AUTO-BRANDING] ğŸ“¦ Branding recibido: {...}
[AUTO-BRANDING] ğŸ¨ Colores a aplicar: {primario: "#ffffff", ...}
[AUTO-BRANDING] âœ… Estilos aplicados correctamente
[AUTO-BRANDING] ğŸ“‹ Resumen de estilos aplicados:
  â€¢ MenÃº lateral (primario): #ffffff
  â€¢ Texto menÃº: #000000
  ...
[AUTO-BRANDING] âœ¨ PÃ¡gina lista con branding aplicado

AL HACER CLIC EN OTRO MÃ“DULO (Facturas, Productos, etc.):
=========================================================
[BRANDING] ğŸ“„ Iframe cargÃ³ nueva pÃ¡gina, re-aplicando estilos...
[AUTO-BRANDING v2.0] ğŸ¨ Iniciando carga de estilos...
[AUTO-BRANDING] âœ… Estilos aplicados correctamente
...

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  âœ… SI VES TODOS ESOS LOGS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

Los estilos DEBEN mantenerse al navegar. Si no:
- Verifica que no hay errores 404 en el tab "Network"
- Busca auto_branding.js?v=2 en Network â†’ debe ser 200 OK
- Busca /api/auth/branding en Network â†’ debe ser 200 OK

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  âŒ SI NO VES LOS LOGS DE [AUTO-BRANDING]
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

1. Ve al tab "Network" de DevTools
2. Filtra por "auto_branding"
3. Recarga la pÃ¡gina
4. Â¿Aparece auto_branding.js?v=2?
   - NO aparece â†’ El archivo no se estÃ¡ cargando
   - Aparece con 304 â†’ EstÃ¡ en cachÃ© (presiona Ctrl+Shift+R)
   - Aparece con 404 â†’ Archivo no existe
   - Aparece con 200 â†’ OK, pero el script tiene un error

5. Si aparece con 200, clic en el archivo
6. Ve al tab "Response"
7. Â¿Ves el cÃ³digo del script?
   - NO â†’ Problema del servidor
   - SÃ â†’ Ve al tab "Console" y busca errores en rojo

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  ğŸ”„ SI SIGUE SIN FUNCIONAR
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

Ejecuta este comando en el servidor:
====================================
cd /var/www/html
head -10 frontend/estadisticas.html

DEBE MOSTRAR (lÃ­nea 7):
<script src="/static/auto_branding.js?v=2"></script>

Si NO estÃ¡ en lÃ­nea 7, ejecuta:
./verificar_estilos.sh

Luego:
sudo systemctl restart apache2

Y vuelve a probar en modo incÃ³gnito.

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  ğŸ“ INFORMACIÃ“N DE DEBUGGING
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

Si despuÃ©s de seguir TODOS estos pasos sigue sin funcionar,
captura pantallas de:

1. Console completa (con todos los logs)
2. Network tab (filtrado por "branding")
3. Resultado de: head -10 /var/www/html/frontend/estadisticas.html

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

Fecha: 26 Oct 2025, 17:23
VersiÃ³n branding.js: v14
VersiÃ³n auto_branding.js: v2
Estado: âœ… DESPLEGADO
