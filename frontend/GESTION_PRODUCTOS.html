<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Gestión de Productos</title>

  <!-- Google Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link
    href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap"
    rel="stylesheet"
  />

  <!-- Enlace al archivo de estilos externo -->
  <link rel="stylesheet" href="../static/styles.css" />
  <link rel="stylesheet" href="../static/notificaciones.css" />
  
  <style>
    /* Estilos específicos para el formulario de productos */
    .form-group {
      margin-bottom: 15px;
    }

    .form-group label {
      display: block;
      margin-bottom: 5px;
      font-weight: 500;
    }

    .form-group input,
    .form-group textarea,
    .form-group select {
      width: 100%;
      padding: 8px;
      border: 1px solid #ccc;
      border-radius: 4px;
    }

    .form-group textarea {
      height: 100px;
      resize: vertical;
    }

    .form-buttons {
      margin-top: 20px;
      display: flex;
      gap: 10px;
    }

    .form-buttons button {
      margin-right: 10px;
    }
    
    /* Estilos para la vista previa del precio */
    .price-preview {
      font-size: 1.2em;
      font-weight: bold;
      margin: 10px 0;
      padding: 10px;
      border: 1px solid #ddd;
      border-radius: 4px;
      background-color: #f9f9f9;
    }
    
    .price-row {
      display: flex;
      justify-content: space-between;
      margin-bottom: 5px;
    }
    
    .price-total {
      border-top: 1px solid #ddd;
      padding-top: 5px;
      margin-top: 5px;
    }
    
    .required::after {
      content: " *";
      color: red;
    }
    
    /* Indicador de campo inválido */
    .is-invalid {
      border: 1px solid red !important;
    }
    /* Fila horizontal para agrupar campos */
    .form-row {
      display: flex;
      gap: 0;
      column-gap: 0;
      flex-wrap: nowrap;
      align-items: flex-end;
      justify-content: flex-start;
      white-space: nowrap;
    }

    .form-row .col {
      flex: 0 0 auto;
      min-width: 0;
      margin-right: 0;
      padding-right: 0;
      width: auto;
    }

    /* Columnas compactas para importes */
    .form-row .compact-col { flex: 0 0 auto; min-width: 0; }
    .form-row .compact-col:not(:last-child) { margin-right: 6px; }

    /* Quitar márgenes verticales extra dentro de la fila */
    .form-row .form-group { margin-bottom: 0; margin-right: 0; padding: 0; }
    .form-row .form-group label { margin-bottom: 1px; display: inline-block; }

    /* Campos de importes más compactos y alineados a la derecha */
    .importe-input {
      text-align: right;
      max-width: 120px;
      padding: 1px 3px;
    }

    .importe-select {
      max-width: 110px;
      padding: 1px 3px;
    }

    /* Visual: texto en mayúsculas */
    .uppercase {
      text-transform: uppercase;
    }
  </style>

  <!-- Axios (CDN) -->
  <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
</head>
<body>
  <div class="container">
    <h1 id="tituloFormulario">Nuevo Producto</h1>

    <!-- Formulario de producto -->
    <form id="formProducto">
      <!-- Nombre (arriba, ancho completo) -->
      <div class="form-group">
        <label for="nombre" class="required">Nombre</label>
        <input 
          type="text" 
          id="nombre" 
          required
          class="uppercase"
        />
        <div id="errorNombre" class="error-message" style="display:none;"></div>
      </div>

      <!-- Configuración de franjas de descuento automáticas -->
      <fieldset id="fieldsetFranjasAuto" style="margin-top:16px; border:1px solid #ddd; padding:10px; border-radius:4px;">
        <legend>Franjas de descuento automáticas</legend>
        <div class="form-group" style="margin-bottom:10px;">
          <label style="display:flex; align-items:center; gap:8px; font-weight:500; line-height:1;">
            <input type="checkbox" id="chkFranjasAuto1500" style="margin:0; width:16px; height:16px;" />
            Cálculo automático 1-500 (tramos de 10) con descuento progresivo hasta 60%
          </label>
          <small>Al activarlo, se fijan: inicio=1, número de franjas=50, ancho=10; el descuento aumenta de forma estricta hasta un máximo del 60%.</small>
        </div>
        <div class="form-row">
          <div class="form-group col compact-col">
            <label for="franja_inicio" class="required">Franja inicial (unidades)</label>
            <input type="number" id="franja_inicio" min="1" step="1" class="importe-input" />
          </div>
          <div class="form-group col compact-col">
            <label for="bandas" class="required">Número de franjas</label>
            <input type="number" id="bandas" min="1" max="60" step="1" class="importe-input" />
          </div>
          <div class="form-group col compact-col">
            <label for="ancho" class="required">Ancho de franja (unidades)</label>
            <input type="number" id="ancho" min="1" step="1" class="importe-input" />
          </div>
        </div>
        <div class="form-row" style="margin-top:8px;">
          <div class="form-group col compact-col">
            <label for="descuento_inicial" class="required">% Descuento inicial</label>
            <input type="number" id="descuento_inicial" min="0" max="60" step="0.0001" class="importe-input" />
          </div>
          <div class="form-group col compact-col">
            <label for="incremento" class="required">% Incremento por franja</label>
            <input type="number" id="incremento" min="0" max="60" step="0.0001" class="importe-input" />
          </div>
        </div>
        <small>Se crearán franjas consecutivas a partir de la unidad indicada, con los anchos y porcentajes configurados. Límite de descuento por franja: 60%.</small>
      </fieldset>

      <!-- Descripción (debajo de nombre, alineada) -->
      <div class="form-group">
        <label for="descripcion">Descripción</label>
        <textarea id="descripcion" class="uppercase"></textarea>
      </div>

      <!-- Debajo de descripción: importes en horizontal -->
      <div class="form-row">
        <div class="form-group col compact-col">
          <label for="subtotal" class="required">Precio base (€)</label>
          <input
            type="number"
            id="subtotal"
            step="0.0001"
            min="0"
            required
            class="importe-input"
          />
          <div id="errorSubtotal" class="error-message" style="display:none;"></div>
        </div>

        <div class="form-group col compact-col">
          <label for="impuestos" class="required">% Impuestos</label>
          <select
            id="impuestos"
            required
            class="importe-select"
          >
            <option value="0">0% (Exento)</option>
            <option value="4">4% (Superreducido)</option>
            <option value="10">10% (Reducido)</option>
            <option value="21">21% (General)</option>
          </select>
          <div id="errorImpuestos" class="error-message" style="display:none;"></div>
        </div>

        <div class="form-group col compact-col">
          <label for="total" class="required">Total (€)</label>
          <input
            type="number"
            id="total"
            step="0.01"
            min="0"
            required
            class="importe-input"
          />
        </div>
      </div>

      <!-- Botones de acción -->
      <div class="form-buttons">
        <button id="btnGuardar" type="submit">Crear Producto</button>
        <button id="btnCancelar" type="button">Cancelar</button>
      </div>

      <!-- Bloque de franjas (visible en edición) -->
      <div id="bloqueFranjasEdicion" style="display:none; margin-top:16px; padding:10px; border:1px dashed #bbb; border-radius:4px; background:#fafafa;">
        <strong>Franjas de descuento:</strong>
        <span id="franjasResumen">-</span>
        <div style="margin-top:8px;">
          <button id="btnGestionarFranjas" type="button">Gestionar franjas…</button>
        </div>
      </div>
    </form>
  </div>

  <script type="module" src="../static/gestion_producto.js"></script>
  
  <!-- Contenedor para notificaciones -->
  <div id="notificaciones-contenedor"></div>
</body>
</html>
