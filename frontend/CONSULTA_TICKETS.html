<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Tickets</title>

  <!-- Incluir Font Awesome para iconos -->
  <link
    rel="stylesheet"
    href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css"
  />

  <!-- Cargar tu archivo de estilos externo -->
  <link rel="stylesheet" href="../static/styles.css" />
  <link rel="stylesheet" href="../static/notificaciones.css" />
  <link rel="stylesheet" href="../static/footer.css" />
</head>
<body>

  <div class="container">
    <h1>Tickets</h1>
    <div class="form-inline">
      <div class="form-group">
        <label for="startDate">Fecha inicio:</label>
        <input type="date" id="startDate" />
      </div>
      <div class="form-group">
        <label for="endDate">Fecha fin:</label>
        <input type="date" id="endDate" />
      </div>
      <div class="form-group">
        <label for="status">Estado:</label>
        <select id="status">
          <option value="">Todos</option>
          <option value="P">Pendiente</option>
          <option value="C">Cobrado</option>
          <option value="RF">Rectificativo</option>
          <option value="A">Anulado</option>
        </select>
      </div>
      <div class="form-group">
        <label for="ticketNumber">Núm. Ticket:</label>
        <input type="text" id="ticketNumber" placeholder="Ej: 12345" />
      </div>
      <div class="form-group">
        <label for="paymentMethod">Forma de Pago:</label>
        <select id="paymentMethod">
          <option value="">Todos</option>
          <option value="E">Efectivo</option>
          <option value="T">Tarjeta</option>
        </select>
      </div>
      <div class="form-group">
        <label for="conceptFilter">Concepto:</label>
        <input type="text" id="conceptFilter" placeholder="Ej: café" />
      </div>
      <div class="form-group">
        <button id="btn-nuevo-ticket">Nuevo Ticket</button>
      </div>
    </div>

    <div class="table-wrapper">
      <div class="table-scroll">
        <table class="grid" id="resultGrid">
          <thead>
            <tr>
              <th>Fecha</th>
              <th>Número</th>
              <th class="text-right">Bruto</th>
              <th class="text-right">Impuestos</th>
              <th class="text-right">Cobrado</th>
              <th class="text-right">Total</th>
              <th class="text-center">Estado</th>
              <th class="text-center">Pago</th>
              <th class="text-center col-imprimir" style="width: 40px;"><i class="fas fa-print"></i></th>
            </tr>
          </thead>
          <tbody id="gridBody">
            <!-- Los resultados se mostrarán aquí -->
          </tbody>
        </table>
      </div>
    </div>
  </div>

  <div class="fixed-footer fixed-footer-ticket">
    <table class="grid">
      <tr>
        <td class="label-totales" style="width: 100px;"><span class="content-cell hidden"><strong>Totales:</strong></span></td>
        <td style="width: 100px;"></td>
        <td class="text-right" style="width: 100px;"><span class="content-cell total-data hidden" id="totalImporteBruto">0,00 €</span></td>
        <td class="text-right" style="width: 100px;"><span class="content-cell total-data hidden" id="totalImporteImpuestos">0,00 €</span></td>
        <td class="text-right" style="width: 100px;"><span class="content-cell total-data hidden" id="totalImporteCobrado">0,00 €</span></td>
        <td class="text-right" style="width: 100px;"><span class="content-cell total-data hidden" id="totalTotal">0,00 €</span></td>
        <td style="width: 100px;"></td>
        <td style="width: 100px;"></td>
        <td class="text-center" style="width: 40px; position: relative;">
          <div class="toggle-totals">
            <i class="fas fa-eye-slash"></i>
          </div>
        </td>
      </tr>
    </table>
  </div>

  <!-- Script principal (módulo) -->
  <script type="module" src="../static/consulta_tickets.js" defer></script>
  
  <!-- Overlay para oscurecer la pantalla -->
  <div id="overlay" class="overlay">
    <div class="progress-container">
      <div id="progress-bar" class="progress-bar">
        <div class="progress-bar-fill"></div>
      </div>
      <p>Cargando, por favor espera...</p>
    </div>
  </div>

  <!-- Script para mostrar/ocultar la fila de totales -->
  <script>
    document.addEventListener('DOMContentLoaded', function() {
      const toggleTotals = document.querySelector('.toggle-totals');
      const totalDataCells = document.querySelectorAll('.fixed-footer-ticket .content-cell');
      const icon = toggleTotals.querySelector('i');

      function updateIcon(show) {
        if (show) {
          icon.classList.remove('fa-eye-slash');
          icon.classList.add('fa-eye');
          toggleTotals.setAttribute('aria-pressed', 'true');
        } else {
          icon.classList.remove('fa-eye');
          icon.classList.add('fa-eye-slash');
          toggleTotals.setAttribute('aria-pressed', 'false');
        }
      }

      function showTotals() {
        totalDataCells.forEach(cell => cell.classList.remove('hidden'));
        updateIcon(true);
      }

      function hideTotals() {
        totalDataCells.forEach(cell => cell.classList.add('hidden'));
        updateIcon(false);
      }

      const totalsVisible = sessionStorage.getItem('totalsVisible');
      if (totalsVisible === 'true') {
        showTotals();
      } else {
        hideTotals();
      }

      toggleTotals.addEventListener('click', function() {
        let currentlyVisible = sessionStorage.getItem('totalsVisible') === 'true';
        if (currentlyVisible) {
          hideTotals();
        } else {
          showTotals();
        }
        sessionStorage.setItem('totalsVisible', !currentlyVisible);
      });

      toggleTotals.addEventListener('keypress', function(event) {
        if (event.key === 'Enter' || event.key === ' ') {
          event.preventDefault();
          toggleTotals.click();
        }
      });
    });
  </script>
</body>
</html>
